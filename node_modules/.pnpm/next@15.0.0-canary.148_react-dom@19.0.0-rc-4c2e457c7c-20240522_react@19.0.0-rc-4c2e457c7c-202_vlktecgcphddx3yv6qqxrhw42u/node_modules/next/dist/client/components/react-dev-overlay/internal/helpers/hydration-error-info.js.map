{"version":3,"sources":["../../../../../../src/client/components/react-dev-overlay/internal/helpers/hydration-error-info.ts"],"sourcesContent":["import { getHydrationErrorStackInfo } from '../../../is-hydration-error'\n\nexport type HydrationErrorState = {\n  // Hydration warning template format: <message> <serverContent> <clientContent>\n  warning?: [string, string, string]\n  componentStack?: string\n  serverContent?: string\n  clientContent?: string\n  // React 19 hydration diff format: <notes> <link> <component diff?>\n  notes?: string\n  reactOutputComponentDiff?: string\n}\n\ntype NullableText = string | null | undefined\n\nexport const hydrationErrorState: HydrationErrorState = {}\n\n// https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMHydrationDiff-test.js used as a reference\nconst htmlTagsWarnings = new Set([\n  'In HTML, %s cannot be a child of <%s>.%s\\nThis will cause a hydration error.%s',\n  'In HTML, %s cannot be a descendant of <%s>.\\nThis will cause a hydration error.%s',\n  'In HTML, text nodes cannot be a child of <%s>.\\nThis will cause a hydration error.',\n  \"In HTML, whitespace text nodes cannot be a child of <%s>. Make sure you don't have any extra whitespace between tags on each line of your source code.\\nThis will cause a hydration error.\",\n])\n\nexport const getHydrationWarningType = (msg: NullableText): 'tag' | 'text' => {\n  if (isHtmlTagsWarning(msg)) return 'tag'\n  return 'text'\n}\n\nconst isHtmlTagsWarning = (msg: NullableText) =>\n  Boolean(msg && htmlTagsWarnings.has(msg))\n\nconst isKnownHydrationWarning = (msg: NullableText) => isHtmlTagsWarning(msg)\n\nexport const getReactHydrationDiffSegments = (msg: NullableText) => {\n  if (msg) {\n    const { message, diff } = getHydrationErrorStackInfo(msg)\n    if (message) return [message, diff]\n  }\n  return undefined\n}\n\n/**\n * Patch console.error to capture hydration errors.\n * If any of the knownHydrationWarnings are logged, store the message and component stack.\n * When the hydration runtime error is thrown, the message and component stack are added to the error.\n * This results in a more helpful error message in the error overlay.\n */\n\nexport function storeHydrationErrorStateFromConsoleArgs(...args: any[]) {\n  const [msg, serverContent, clientContent, componentStack] = args\n  if (isKnownHydrationWarning(msg)) {\n    hydrationErrorState.warning = [\n      // remove the last %s from the message\n      msg,\n      serverContent,\n      clientContent,\n    ]\n    hydrationErrorState.componentStack = componentStack\n    hydrationErrorState.serverContent = serverContent\n    hydrationErrorState.clientContent = clientContent\n  }\n}\n"],"names":["getHydrationWarningType","getReactHydrationDiffSegments","hydrationErrorState","storeHydrationErrorStateFromConsoleArgs","htmlTagsWarnings","Set","msg","isHtmlTagsWarning","Boolean","has","isKnownHydrationWarning","message","diff","getHydrationErrorStackInfo","undefined","args","serverContent","clientContent","componentStack","warning"],"mappings":";;;;;;;;;;;;;;;;;IAyBaA,uBAAuB;eAAvBA;;IAUAC,6BAA6B;eAA7BA;;IApBAC,mBAAmB;eAAnBA;;IAmCGC,uCAAuC;eAAvCA;;;kCAlD2B;AAepC,MAAMD,sBAA2C,CAAC;AAEzD,iIAAiI;AACjI,MAAME,mBAAmB,IAAIC,IAAI;IAC/B;IACA;IACA;IACA;CACD;AAEM,MAAML,0BAA0B,CAACM;IACtC,IAAIC,kBAAkBD,MAAM,OAAO;IACnC,OAAO;AACT;AAEA,MAAMC,oBAAoB,CAACD,MACzBE,QAAQF,OAAOF,iBAAiBK,GAAG,CAACH;AAEtC,MAAMI,0BAA0B,CAACJ,MAAsBC,kBAAkBD;AAElE,MAAML,gCAAgC,CAACK;IAC5C,IAAIA,KAAK;QACP,MAAM,EAAEK,OAAO,EAAEC,IAAI,EAAE,GAAGC,IAAAA,4CAA0B,EAACP;QACrD,IAAIK,SAAS,OAAO;YAACA;YAASC;SAAK;IACrC;IACA,OAAOE;AACT;AASO,SAASX;IAAwC,IAAA,IAAA,OAAA,UAAA,QAAA,AAAGY,OAAH,UAAA,OAAA,OAAA,GAAA,OAAA,MAAA;QAAGA,KAAH,QAAA,SAAA,CAAA,KAAc;;IACpE,MAAM,CAACT,KAAKU,eAAeC,eAAeC,eAAe,GAAGH;IAC5D,IAAIL,wBAAwBJ,MAAM;QAChCJ,oBAAoBiB,OAAO,GAAG;YAC5B,sCAAsC;YACtCb;YACAU;YACAC;SACD;QACDf,oBAAoBgB,cAAc,GAAGA;QACrChB,oBAAoBc,aAAa,GAAGA;QACpCd,oBAAoBe,aAAa,GAAGA;IACtC;AACF"}