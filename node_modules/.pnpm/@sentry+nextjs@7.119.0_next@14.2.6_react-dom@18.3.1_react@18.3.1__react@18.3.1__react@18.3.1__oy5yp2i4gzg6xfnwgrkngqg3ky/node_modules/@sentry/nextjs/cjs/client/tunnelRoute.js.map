{"version":3,"file":"tunnelRoute.js","sources":["../../../src/client/tunnelRoute.ts"],"sourcesContent":["import type { BrowserOptions } from '@sentry/react';\nimport { GLOBAL_OBJ, dsnFromString, logger } from '@sentry/utils';\n\nimport { DEBUG_BUILD } from '../common/debug-build';\n\nconst globalWithInjectedValues = GLOBAL_OBJ as typeof GLOBAL_OBJ & {\n  __sentryRewritesTunnelPath__?: string;\n};\n\n/**\n * Applies the `tunnel` option to the Next.js SDK options based on `withSentryConfig`'s `tunnelRoute` option.\n */\nexport function applyTunnelRouteOption(options: BrowserOptions): void {\n  const tunnelRouteOption = globalWithInjectedValues.__sentryRewritesTunnelPath__;\n  if (tunnelRouteOption && options.dsn) {\n    const dsnComponents = dsnFromString(options.dsn);\n    if (!dsnComponents) {\n      return;\n    }\n    const sentrySaasDsnMatch = dsnComponents.host.match(/^o(\\d+)\\.ingest(?:\\.([a-z]{2}))?\\.sentry\\.io$/);\n    if (sentrySaasDsnMatch) {\n      const orgId = sentrySaasDsnMatch[1];\n      const regionCode = sentrySaasDsnMatch[2];\n      let tunnelPath = `${tunnelRouteOption}?o=${orgId}&p=${dsnComponents.projectId}`;\n      if (regionCode) {\n        tunnelPath += `&r=${regionCode}`;\n      }\n      options.tunnel = tunnelPath;\n      DEBUG_BUILD && logger.info(`Tunneling events to \"${tunnelPath}\"`);\n    } else {\n      DEBUG_BUILD && logger.warn('Provided DSN is not a Sentry SaaS DSN. Will not tunnel events.');\n    }\n  }\n}\n"],"names":["GLOBAL_OBJ","dsnFromString","DEBUG_BUILD","logger"],"mappings":";;;;;AAKA,MAAM,wBAAA,GAA2BA,gBAAW;;AAE5C,CAAA;AACA;AACA;AACA;AACA;AACO,SAAS,sBAAsB,CAAC,OAAO,EAAwB;AACtE,EAAE,MAAM,iBAAA,GAAoB,wBAAwB,CAAC,4BAA4B,CAAA;AACjF,EAAE,IAAI,iBAAA,IAAqB,OAAO,CAAC,GAAG,EAAE;AACxC,IAAI,MAAM,gBAAgBC,mBAAa,CAAC,OAAO,CAAC,GAAG,CAAC,CAAA;AACpD,IAAI,IAAI,CAAC,aAAa,EAAE;AACxB,MAAM,OAAM;AACZ,KAAI;AACJ,IAAI,MAAM,kBAAmB,GAAE,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,+CAA+C,CAAC,CAAA;AACxG,IAAI,IAAI,kBAAkB,EAAE;AAC5B,MAAM,MAAM,KAAM,GAAE,kBAAkB,CAAC,CAAC,CAAC,CAAA;AACzC,MAAM,MAAM,UAAW,GAAE,kBAAkB,CAAC,CAAC,CAAC,CAAA;AAC9C,MAAM,IAAI,UAAA,GAAa,CAAC,EAAA,iBAAA,CAAA,GAAA,EAAA,KAAA,CAAA,GAAA,EAAA,aAAA,CAAA,SAAA,CAAA,CAAA,CAAA;AACA,MAAA,IAAA,UAAA,EAAA;AACA,QAAA,UAAA,IAAA,CAAA,GAAA,EAAA,UAAA,CAAA,CAAA,CAAA;AACA,OAAA;AACA,MAAA,OAAA,CAAA,MAAA,GAAA,UAAA,CAAA;AACA,MAAAC,sBAAA,IAAAC,YAAA,CAAA,IAAA,CAAA,CAAA,qBAAA,EAAA,UAAA,CAAA,CAAA,CAAA,CAAA,CAAA;AACA,KAAA,MAAA;AACA,MAAAD,sBAAA,IAAAC,YAAA,CAAA,IAAA,CAAA,gEAAA,CAAA,CAAA;AACA,KAAA;AACA,GAAA;AACA;;;;"}