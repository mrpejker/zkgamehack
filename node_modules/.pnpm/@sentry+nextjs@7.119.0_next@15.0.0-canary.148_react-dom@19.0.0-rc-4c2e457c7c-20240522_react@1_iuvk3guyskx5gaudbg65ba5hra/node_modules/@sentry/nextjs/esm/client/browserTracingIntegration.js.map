{"version":3,"file":"browserTracingIntegration.js","sources":["../../../src/client/browserTracingIntegration.ts"],"sourcesContent":["import {\n  BrowserTracing as OriginalBrowserTracing,\n  browserTracingIntegration as originalBrowserTracingIntegration,\n  defaultRequestInstrumentationOptions,\n  startBrowserTracingNavigationSpan,\n  startBrowserTracingPageLoadSpan,\n} from '@sentry/react';\nimport type { StartSpanOptions } from '@sentry/types';\nimport { nextRouterInstrumentation } from '../index.client';\n\n/**\n * A custom BrowserTracing integration for Next.js.\n *\n * @deprecated Use `browserTracingIntegration` instead.\n */\n// eslint-disable-next-line deprecation/deprecation\nexport class BrowserTracing extends OriginalBrowserTracing {\n  // eslint-disable-next-line deprecation/deprecation\n  public constructor(options?: ConstructorParameters<typeof OriginalBrowserTracing>[0]) {\n    super({\n      // eslint-disable-next-line deprecation/deprecation\n      tracingOrigins:\n        process.env.NODE_ENV === 'development'\n          ? [\n              // Will match any URL that contains \"localhost\" but not \"webpack.hot-update.json\" - The webpack dev-server\n              // has cors and it doesn't like extra headers when it's accessed from a different URL.\n              // TODO(v8): Ideally we rework our tracePropagationTargets logic so this hack won't be necessary anymore (see issue #9764)\n              /^(?=.*localhost)(?!.*webpack\\.hot-update\\.json).*/,\n              /^\\/(?!\\/)/,\n            ]\n          : // eslint-disable-next-line deprecation/deprecation\n            [...defaultRequestInstrumentationOptions.tracingOrigins, /^(api\\/)/],\n      // eslint-disable-next-line deprecation/deprecation\n      routingInstrumentation: nextRouterInstrumentation,\n      ...options,\n    });\n  }\n}\n\n/**\n * A custom BrowserTracing integration for Next.js.\n */\nexport function browserTracingIntegration(\n  options?: Parameters<typeof originalBrowserTracingIntegration>[0],\n): ReturnType<typeof originalBrowserTracingIntegration> {\n  const browserTracingIntegrationInstance = originalBrowserTracingIntegration({\n    // eslint-disable-next-line deprecation/deprecation\n    tracingOrigins:\n      process.env.NODE_ENV === 'development'\n        ? [\n            // Will match any URL that contains \"localhost\" but not \"webpack.hot-update.json\" - The webpack dev-server\n            // has cors and it doesn't like extra headers when it's accessed from a different URL.\n            // TODO(v8): Ideally we rework our tracePropagationTargets logic so this hack won't be necessary anymore (see issue #9764)\n            /^(?=.*localhost)(?!.*webpack\\.hot-update\\.json).*/,\n            /^\\/(?!\\/)/,\n          ]\n        : // eslint-disable-next-line deprecation/deprecation\n          [...defaultRequestInstrumentationOptions.tracingOrigins, /^(api\\/)/],\n    ...options,\n    instrumentNavigation: false,\n    instrumentPageLoad: false,\n  });\n\n  const fullOptions = {\n    ...browserTracingIntegrationInstance.options,\n    instrumentPageLoad: true,\n    instrumentNavigation: true,\n    ...options,\n  };\n\n  return {\n    ...browserTracingIntegrationInstance,\n    options: fullOptions,\n    afterAllSetup(client) {\n      const startPageloadCallback = (startSpanOptions: StartSpanOptions): void => {\n        startBrowserTracingPageLoadSpan(client, startSpanOptions);\n      };\n\n      const startNavigationCallback = (startSpanOptions: StartSpanOptions): void => {\n        startBrowserTracingNavigationSpan(client, startSpanOptions);\n      };\n\n      // We need to run the navigation span instrumentation before the `afterAllSetup` hook on the normal browser\n      // tracing integration because we need to ensure the order of execution is as follows:\n      // Instrumentation to start span on RSC fetch request runs -> Instrumentation to put tracing headers from active span on fetch runs\n      // If it were the other way around, the RSC fetch request would not receive the tracing headers from the navigation transaction.\n      // eslint-disable-next-line deprecation/deprecation\n      nextRouterInstrumentation(\n        () => undefined,\n        false,\n        fullOptions.instrumentNavigation,\n        startPageloadCallback,\n        startNavigationCallback,\n      );\n\n      browserTracingIntegrationInstance.afterAllSetup(client);\n\n      // eslint-disable-next-line deprecation/deprecation\n      nextRouterInstrumentation(\n        () => undefined,\n        fullOptions.instrumentPageLoad,\n        false,\n        startPageloadCallback,\n        startNavigationCallback,\n      );\n    },\n  };\n}\n"],"names":["OriginalBrowserTracing","originalBrowserTracingIntegration"],"mappings":";;;AAUA;AACA;AACA;AACA;AACA;AACA;AACO,MAAM,cAAe,SAAQA,gBAAuB,CAAA;AAC3D;AACA,GAAS,WAAW,CAAC,OAAO,EAA4D;AACxF,IAAI,KAAK,CAAC;AACV;AACA,MAAM,cAAc;AACpB,QAAQ,OAAO,CAAC,GAAG,CAAC,aAAa,aAAA;AACjC,YAAY;AACZ;AACA;AACA;AACA,cAAc,mDAAmD;AACjE,cAAc,WAAW;AACzB,aAAY;AACZ;AACA,YAAY,CAAC,GAAG,oCAAoC,CAAC,cAAc,EAAE,UAAU,CAAC;AAChF;AACA,MAAM,sBAAsB,EAAE,yBAAyB;AACvD,MAAM,GAAG,OAAO;AAChB,KAAK,CAAC,CAAA;AACN,GAAE;AACF,CAAA;AACA;AACA;AACA;AACA;AACO,SAAS,yBAAyB;AACzC,EAAE,OAAO;AACT,EAAwD;AACxD,EAAE,MAAM,iCAAA,GAAoCC,2BAAiC,CAAC;AAC9E;AACA,IAAI,cAAc;AAClB,MAAM,OAAO,CAAC,GAAG,CAAC,aAAa,aAAA;AAC/B,UAAU;AACV;AACA;AACA;AACA,YAAY,mDAAmD;AAC/D,YAAY,WAAW;AACvB,WAAU;AACV;AACA,UAAU,CAAC,GAAG,oCAAoC,CAAC,cAAc,EAAE,UAAU,CAAC;AAC9E,IAAI,GAAG,OAAO;AACd,IAAI,oBAAoB,EAAE,KAAK;AAC/B,IAAI,kBAAkB,EAAE,KAAK;AAC7B,GAAG,CAAC,CAAA;AACJ;AACA,EAAE,MAAM,cAAc;AACtB,IAAI,GAAG,iCAAiC,CAAC,OAAO;AAChD,IAAI,kBAAkB,EAAE,IAAI;AAC5B,IAAI,oBAAoB,EAAE,IAAI;AAC9B,IAAI,GAAG,OAAO;AACd,GAAG,CAAA;AACH;AACA,EAAE,OAAO;AACT,IAAI,GAAG,iCAAiC;AACxC,IAAI,OAAO,EAAE,WAAW;AACxB,IAAI,aAAa,CAAC,MAAM,EAAE;AAC1B,MAAM,MAAM,qBAAA,GAAwB,CAAC,gBAAgB,KAA6B;AAClF,QAAQ,+BAA+B,CAAC,MAAM,EAAE,gBAAgB,CAAC,CAAA;AACjE,OAAO,CAAA;AACP;AACA,MAAM,MAAM,uBAAA,GAA0B,CAAC,gBAAgB,KAA6B;AACpF,QAAQ,iCAAiC,CAAC,MAAM,EAAE,gBAAgB,CAAC,CAAA;AACnE,OAAO,CAAA;AACP;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,yBAAyB;AAC/B,QAAQ,MAAM,SAAS;AACvB,QAAQ,KAAK;AACb,QAAQ,WAAW,CAAC,oBAAoB;AACxC,QAAQ,qBAAqB;AAC7B,QAAQ,uBAAuB;AAC/B,OAAO,CAAA;AACP;AACA,MAAM,iCAAiC,CAAC,aAAa,CAAC,MAAM,CAAC,CAAA;AAC7D;AACA;AACA,MAAM,yBAAyB;AAC/B,QAAQ,MAAM,SAAS;AACvB,QAAQ,WAAW,CAAC,kBAAkB;AACtC,QAAQ,KAAK;AACb,QAAQ,qBAAqB;AAC7B,QAAQ,uBAAuB;AAC/B,OAAO,CAAA;AACP,KAAK;AACL,GAAG,CAAA;AACH;;;;"}