import fs from "node:fs";
const FILE_NAME = "db.json";
export class FilePropertyStorage {
    constructor() {
        this.json = undefined;
    }
    readFile() {
        return new Promise((accept) => {
            fs.readFile(FILE_NAME, (err, buffer) => {
                if (err === null) {
                    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
                    accept(JSON.parse(buffer.toString()));
                }
                else {
                    accept({});
                }
            });
        });
    }
    writeFile(content) {
        const encoded = JSON.stringify(content);
        return new Promise((accept, reject) => {
            fs.writeFile(FILE_NAME, encoded, (err) => {
                if (err === null) {
                    accept(true);
                }
                else {
                    reject(err);
                }
            });
        });
    }
    async get(key) {
        if (this.json === undefined) {
            this.json = await this.readFile();
        }
        return this.json[key];
    }
    async set(key, value) {
        if (this.json === undefined) {
            this.json = await this.readFile();
        }
        this.json[key] = value;
        await this.writeFile(this.json);
    }
}
